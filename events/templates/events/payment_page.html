{% extends 'events/base.html' %}

{% block content %}
<div class="container mx-auto">
    <div class="flex justify-center py-8">
        <div class="w-full max-w-md">
            <div class="bg-white rounded-xl shadow-2xl overflow-hidden">
                <!-- Header with Timer -->
                <div class="bg-gray-800 text-white p-5 text-center relative">
                    <h2 class="text-xl font-bold">Complete Your Payment</h2>
                    <p class="text-sm text-gray-300">for "{{ event.title }}"</p>
                    <div class="absolute top-3 right-4 bg-gray-700 text-xs px-2 py-1 rounded-md">
                        Expires in <span id="timer">05:00</span>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="p-6 md:p-8">
                    <!-- Amount Display -->
                    <div class="text-center mb-6">
                        <p class="text-gray-600 text-sm">Total Amount Payable</p>
                        <p class="text-5xl font-extrabold text-gray-900">₹{{ event.fee_amount }}</p>
                    </div>

                    <!-- QR Code Section -->
                    <div class="flex flex-col items-center">
                        <p class="font-semibold text-gray-700 mb-2">Scan QR with any UPI App</p>
                                                <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=upi://pay?pa=cems@okhdfcbank%26pn=CollegeEventHub%26am={{event.fee_amount}}%26cu=INR" 
                             alt="UPI Payment QR Code" 
                             class="rounded-lg border-4 border-gray-200 p-1">
                        <p class="text-xs text-gray-500 mt-2">cems@okhdfcbank</p>
                    </div>

                    <!-- Separator -->
                    <div class="flex items-center my-6">
                        <div class="flex-grow border-t border-gray-300"></div>
                        <span class="flex-shrink mx-4 text-gray-500 font-medium">OR</span>
                        <div class="flex-grow border-t border-gray-300"></div>
                    </div>

                    <!-- UPI ID Form -->
                    <div>
                        <p class="font-semibold text-gray-700 text-center mb-3">Pay using UPI ID</p>
                        <form action="{% url 'process_payment' event.id %}" method="POST" class="space-y-4">
                            {% csrf_token %}
                            <div>
                                <label for="upi_id" class="sr-only">Enter your UPI ID</label>
                                <input type="text" id="upi_id" class="form-input text-center" placeholder="yourname@bank" value="demouser@upi" required>
                            </div>
                            <button type="submit" class="w-full btn btn-primary text-lg py-3 transition-transform transform hover:scale-105">
                                Pay ₹{{ event.fee_amount }} Securely
                            </button>
                        </form>
                    </div>

                    <!-- Footer with Cancel Link and Logos -->
                    <div class="mt-6 text-center">
                        <a href="{% url 'event_detail' event.id %}" class="text-sm text-gray-500 hover:underline">Cancel Payment</a>
                        <div class="flex justify-center items-center space-x-4 mt-4 opacity-60">
                            <img src="https://placehold.co/60x25/f1f5f9/94a3b8?text=GPay" alt="Google Pay" class="h-6">
                            <img src="https://placehold.co/60x25/f1f5f9/94a3b8?text=PhonePe" alt="PhonePe" class="h-6">
                            <img src="https://placehold.co/60x25/f1f5f9/94a3b8?text=Paytm" alt="Paytm" class="h-6">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Simple countdown timer for effect
    const timerDisplay = document.getElementById('timer');
    let duration = 5 * 60; // 5 minutes in seconds

    const interval = setInterval(function () {
        let minutes = parseInt(duration / 60, 10);
        let seconds = parseInt(duration % 60, 10);

        minutes = minutes < 10 ? "0" + minutes : minutes;
        seconds = seconds < 10 ? "0" + seconds : seconds;

        timerDisplay.textContent = minutes + ":" + seconds;

        if (--duration < 0) {
            clearInterval(interval);
            timerDisplay.textContent = "Expired";
            // Optionally, disable the pay button
            document.querySelector('button[type="submit"]').disabled = true;
            document.querySelector('button[type="submit"]').textContent = "Session Expired";
        }
    }, 1000);
</script>
{% endblock %}

